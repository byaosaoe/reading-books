# 4.1 Amazon EC2란: 짧은 시간에 실행 환경을 구축할 수 있는 가상 서버

## 4.1.1 Amazon EC2란
- Amazon Elastic Compute Cloud(Amazon EC2): 컴퓨팅 용량을 제공하는 서비스이다. 쉽게 말해서 서버에 필요한 세트를 클라우드에서 빌릴 수 있다.
- 임대 서버는 이미 만들어진 서버 기계나 서버 기능을 빌리는 것이지만,
- 클라우드의 경우에는 빌린 도구를 사용하여 자신의 서버를 만든다고 생각하면 된다.
- 클라우드는 하드웨어의 구성과 OS의 조합을 탄력적으로 선택할 수 있고 구축이 쉽다.
- EC2는 매니지드 서비스가 아니다. 따라서 서버 및 네트워크 운영은 AWS가 담당하지만, OS를 포함하여 필요한 소프트웨어는 사용자가 직접 설치하고 운영해야 한다.

<br/>

## 4.1.2 클릭 한 번으로 최적의 서버를 만들 수 있다
- EC2는 콘솔에서 간단하게 서버를 생성할 수 있기 때문에 서버에 대한 기술적 지식은 그다지 피룡하지 않다.
- 다양한 서버 시스템의 조합(인스턴스 유형)과 OS 및 소프트웨어의 조합이 준비되어 있기 때문에 이를 선택하기만 하면 된다.
- EC2는 매니지드 서비스가 아니므로 AWS에 의해서 강제로 업데이트되지 않는다.
  - 자유도가 높은 반면 관리하기는 번거로운 서비스이다.
 
<br/>

## 4.1.3 바로 생성할 수 있고 바로 삭제할 수 있다
- 바로 생성하고 바로 삭제할 수 있다.
  - 불필요한 리소스 유지할 필요 없음
  - 불확실성이 높은 경우에 매우 유용함
- 복제 및 스케일 아웃, 스케일 다운 기능이 있어 이벤트 사이트 등 일시적으로 접속이 증가하는 경우에 적합하다.

<hr/>

# 4.2 EC2의 사용 절차: 가상 서버를 사용하기까지

## 4.2.2 EC2 서비스의 기능

|항목|내용|
|:---|:---|
|인스턴스|AWS 클라우드에 생성한 가상 서버를 의미한다. EC2는 AMI로 몇 번이고 같은 구성의 서버를 생성할 수 있기 때문에 생성한 서버를 이와 같이 부른다.|
|AMI|가상 이미지를 말한다. 인스턴스를 생성하는 기준이 되는 금형과 같은 것이다.|
|키 페어|인스턴스에 접속할 때 인증을 위해 사용하는 키이다.|
|EBS|AWS 클라우드에서 사용할 수 있는 스토리지이다. 인스턴스 스토리지로 사용한다.|
|보안 그룹|가상 방화벽으로, 1개 이상의 인스턴스 트래픽을 제한한다.|
|Elastic IP|정적(고정) IPv4 주소이다.|

<br/>

## 4.2.3 EC2의 사용 절차
1. AWS에 로그인한다
    - 리전을 선택하고 관리 콘솔을 연다
    - EC2 대시보드를 연다
2. EC2 인스턴스를 생성한다
    - AMI를 선택한다
    - 인스턴스 유형을 선택한다
    - 네트워크와 IP 주소를 할당한다
    - 스토리지를 추가한다
    - 보안 그룹을 설정한다
    - 키 페어를 선택(작성)한다
3. EC2에 접속한다
    - SSH로 EC2에 접속한다
4. 소프트웨어를 설치하고 설정한다
    - 소프트웨어 설치
    - 소프트웨어 설정
  
<br/>

## 4.2.4 인스턴스 설정 항목
|항목|내용|
|:---|:---|
|AMI|EC2 인스턴스의 가상 이미지이며 소프트웨어 구성을 작성한 템플릿이다. 사용할 OS, 소프트웨어 등 어떤 인스턴스를 만들 것인지 정하고 이에 해당하는 AMI를 선택한다.|
|인스턴스 유형|EC2 인스턴스의 장비 사양이다. CPU, 메모리, 장비 유형을 결정한다.|
|리전|서버를 설치할 지역이다. 전 세계에 이중화를 고려한 경우는 다른 나라에도 설치한다.|
|네트워크|EC2 인스턴스를 배치할 네트워크이다. AWS의 VPC에서 선택한다. VPC가 없으면 새로 생성하거나 기본 VPC를 사용한다.|
|서브넷|설치할 네트워크의 범위이다. VPC 내에 어떤 서브넷을 설치할지 선택한다. 서브넷을 선택하면 가용 영역이라고 하는 설치 장소와 어떤 범위에 사설 IP가 부여될지가 결정된다.|
|IAM 역할|인스턴스의 접속 권한 정책을 설정한다. 다른 서비스에 접속하고 싶을 때 할당해야 한다.|
|스토리지의 용량과 종류|서버 장비의 스토리지이다. OS가 설치된 장소에 있다. 기본적으로 EBS를 선택하고 사용할 디스크 용량과 스토리지의 종류를 선택한다. 용도에 따라서는 인스턴스 스토어(전원이 끊기면 데이터가 사라지지만 읽기 성능이 빨라진다. 일부 인스턴스 유형에 대응)를 선택해도 좋다. S3와 같은 외부 스토리지는 선택할 수 없다.|
|태그(EC2 인스턴스의 레이블)|인스턴스에 임의의 태그를 부여할 수 있다. Name 태그를 사용하여 인스턴스 이름에 부여할 수 있으므로 사용하면 편리하다.|
|보안 그룹|프로토콜별로 포트 혹은 IP 주소, 아니면 양쪽 모두 필터링을 설정한다.|

<hr/>

# 4.3 인스턴스 생성과 요금: 가상 서버 생성 예시

## 4.3.2 인스턴스의 요금
- 인스턴스의 이용 요금은 4가지 항목을 합한 것이다.
- `요금 = 인스턴스 사용량(가동 시간*단가) + EBS(스토리지) 요금(용량*단가) + 통신 요금(아웃바운드 통신 요금) + 그 외 옵션`
- 스토리지 요금의 용량은 저장용량 단위가 아닌 **보유한 용량 단위**임에 주의하자
- 인스턴스와는 달리 정지하고 있는 동안에도 요금이 부과된다.
- 인터넷에서 인스턴스로 들어오는(인바인드) 통신료는 무료이며 인터넷으로 나가는 통신만 요금이 부과된다. (리전에 따라 조금씩 다름)

## EC2가 적합하지 않은 경우
- 단순 서버 1대로 구성되어 그다지 변화가 없는 시스템의 경우 AWS의 장점을 살릴 수 없다.
- EC2는 스스로 관리해야 하므로 단순히 구축만 하는 시스템에는 적합하지 않다.

<br/>

# 4.4 AMI: OS 및 소프트웨어가 설치된 디스크 이미지

## 4.4.1 AMI와 인스턴스
- AMI란 OS와 소프트웨어 구성을 기록한 템플릿이다.
- 인스턴스를 생성하기 위한 금형과 같은것
- 금형을 한 번 만들어 두면 얼마든지 같은 설정의 서버를 생성하는 것이 가능하다.
- AMI를 개인이 만들어서 마켓플레이스에 배포할 수도 있다.
  - 단, AMI가 반드시 안전하다는 보증은 없기 때문에 배포자를 잘 확인하고 사용하자.

<hr/>

# 4.5 인스턴스 유형: 용도에 맞게 머신을 선택하자

## 4.5.1 인스턴스 유형이란
- 인스턴스 유형이란 머신의 용도이다.
- CPU, 메모리, 스토리지, 네트워크 용량 등이 용도에 맞게 조합되어 있다.

|용도|인스턴스 유형|
|:---:|:---:|
|범용|A1, T3, T2, M5, M5a, M4, T3a|
|컴퓨팅 최적화|C5, C5n, C4|
|메모리 최적화|R5, R5a, R4, X1e, X1, 고성능 메모리, z1d|
|가속화된 컴퓨팅 최적화|P3, P2, G3, F1|
|스토리지 최적화|H1, I3, D2|

<br/>

## 4.5.2 인스턴스의 유형과 크기
- 인스턴스의 유형과 크기의 조합이 머신의 성능을 의미한다.

<hr/>

# 4.6 Amazon EBS: Amazon EC2의 스토리지 볼륨

## 4.6.1 EBS란
- Amazon EBS(Amazon Elastic Block Store)는 영구적인 블록 스토리지 볼륨이다.
- EC2 인스턴스와 조합하여 사용한다.
- 블록 스토리지 볼륨: 데이터를 바이트 블록 단위로 디스크에 저장하는 일반적인 방식
- EBS는 HDD와 SSD를 선택할 수 있다.
- HDD는 대용량을 지원하며 SSD에 비해 가격이 싸지만 성능이 낮다.
- SSD는 가격이 조금 비싸지만 IOPS(Input Output Per Second)가 빠르다.
- 고성능이라면 SSD로, 저비용이라면 HDD가 적합하다.

|특징|HDD(Hard Disk Drive)|SSD(Solid State Drive)|
|:---:|:---:|:---:|
|읽기 쓰기 속도|보통|빠르다|
|가격|보통|높다|
|소비 전력|조금 높다|보통|
|내구성|약하다|강하다|
|고장|이중화되어 있다|이중화되어 있다|

<br/>

◼ EBS의 기능

|기능|설명|
|:---|:---|
|탄력적 볼륨|볼륨 크기를 간단히 조정할 수 있는 기능이다.|
|스냅샷|어떤 시점의 데이터를 통째로 저장하는 기능이다.|
|데이터 라이프 사이클 매니저|일정에 따라서 스냅샷을 생성, 삭제하는 기능이다.|
|최적화 인스턴스|특정 인스턴스 유형을 최적화 인스턴스로써 읽기 쓰기를 고소고하하는 기능이다.|
|암호화|데이터 볼륨, 부팅 볼륨 및 스냅샷을 암호화하는 기능이다. KMS(AWS Key Management Service, 키를 생성/관리할 수 있는 기능)를 사용할 수 있다.|

<hr/>

# 4.7 SSH를 사용한 접속과 키 페어: 공개키 암호 방식을 이용한 접근 관리

## 4.7.1 SSH로 접속하기
- 서버 성능을 올리거나 내리거나 백업하는 등 서버의 전반적인 작업은 관리 콘솔에서 수행한다.
- 하지만 서버에 설치한 소프트웨어를 조작하려면 SSH 방식을 사용해 원격 접속으로 조작하는 것이 일반적이다.
- 따라서 서버에서 SSH를 사용하기 위한 프로그램을 기동하고, 클라이언트에는 조작하기 위한 소프트웨어를 설치해야 한다.
- 서버에 SSH를 사용하기 위한 프로그램을 설치하지 않아도 OS에 이미 설치되어 동작하고 있다.
- 클라이언트는 Putty(퍼티)나 Tera Term과 같은 소프트웨어를 주로 사용한다.

<br/>

## 4.7.2 키 페어란
- 로그인할 때 인증으로 사용하며, 공개키와 비밀키로 된 한 쌍을 말한다.
- 공개키 방식이라고 불리며 자물쇠를 잠그는 키와 자물쇠를 여는 키를 공개키와 비밀키로 조합하여 사용하는 방법이다.
- AWS는 이 두 키를 파일 하나로 취급한다.
- SS로 서버(인스턴스)에 접속할 때 인스턴스쪽에서 키 페어에 포함되어 있는 공개키를 지정하고, 클라이언트쪽 소프트웨어에는 내려받은 키페어 파일을 비밀키로 설정하여 사용한다.
- 키페어는 생성했을 때만 내려받기가 가능하며 재발행이 안 된다. 잊어버렸을 경우 서버를 재구축해야 한다.

<hr/>

# 4.8 Elastic IP 주소: 고정 공인 IP 주소를 부여

## 4.8.1 Elastic IP 주소란
- AWS가 제공하는 정적인 공인 IPv4 주소이다.
- EC2 인스턴스는 정지 후 다시 시작하면 공인 IP 주소가 바뀌가 된다. => 서버로 사용 불가능
- 고정 IP 주소를 인스턴스와 연결해야 하고, 이 고정 IP가 Elastic IP 주소이다.

<br/>

## 4.8.2 Elastic IP 주소의 확보와 부여
- Elastic IP 주소는 AWS 계정에 연결되어 있다.
- 인스턴스 단위가 아니므로 IP 주소를 부여한 인스턴스를 사겢해도 확보한 IP 주소는 그대로 AWS 계정에서 소유하는 것이 가능하다.

<br/>

## 4.8.3 Elastic IP 주소의 요금
- 기본적으로 인스턴스에 부여된 IP 한개는 무료이고, 추가로 IP를 연결하면 IP는 시간에 비례하여 요금이 부과된다.
- **소유한 IP가 중지된 인스턴스나 분리된 네트워크에 연결된 경우에도 시간당 요금이 부과된다.**
- 따라서 사용하지 않는 IP 주소는 해지하는 것이 좋다.

<hr/>

# 4.9 Elastic Load Balancing: 트래픽을 분배하는 분산 장치

## 4.9.1 ELB란
- ELB는 AWS가 제공하는 로드 밸런서이다.
- 로드 밸런서는 서버에 집주오디는 접속(트래픅)을 서버 여러 대가 네트워크에 분배하는 방식이다.

<br/>

## 4.9.2 ELB의 종류
1. ALB(Application Load Balancer)
    - HTTP 및 HTTPS에 가장 적합한 로드 밸런서이다.
    - OSI 모형의 애플리케이션 계층에서 동작한다.
    - 요청되는 명령어의 내용을 보고 판단하기 때문에 대상의 URL 디렉터리 단위로 분배하는 것이 가능하다.
    - 인스턴스와 로드 밸런서 사이의 통신은 암호화가 가능하다.
    - 분배 대상으로 정적 IP 주소를 설정하고 그 IP를 가진 호스트로 전송할 수 없다.
    - 지원 프로토콜: HTTP, HTTPS
2. NLB(Network Load Balancer)
    - OSI 모형의 전송 계층에서 동작한다.
    - 패킷이라고 불리는 단편 데이터밖에 볼 수 없기 때문에 ALB만큼 상세하게 분배할 수 없다.
    - 대신 분배 대상의 정적 IP 주소를 설정할 수 있고
    - 서버에 접속한 클라이언트의 IP 주소를 그대로 서버에 전송하도록 설정할 수도 있다.
    - 지원 프로토콜: TCP, TLS
3. CLB(Classic Load Balancer)
    - 오래된 유형의 로드 밸런서이다.
    - 지원하는 프로토콜이 많지만 앞으로 구축할 시스템에 사용하는건 권장되지 않는다.
    - 지원 프로토콜: TCP, SSL/TLS, HTTP, HTTPS

<br/>

## 4.9.3 ELB의 요금
- ALB와 NLB의 요금은 시간당 사용 요금과 LCU(로드 밸런서 용량 단위) 요금의 합계로 계산한다.
- `요금 = 사용 요금(사용 단가*시간) + LCU 요금(LCU 사용량*LCU 단가*시간)`
- LCU 요금은 측정 항목 4가지에 대해서 LCU 사용량이 '어떤 LCU 항목'에 해당하는지 환산하고 가장 큰 항목만 과금 대상으로 한다.
1. 새 연결 수(1LCU = 초당 25개의 새로운 연결): 초당 **새로운** 확정 연결 수이다.
2. 활성 연결 수(1LCU = 분당 3,000개의 활성 연결): 분당 활성 연결 수이다. 즉, 현재 연결되어 있는 접속 수이다.
3. 처리된 바이트(1LCU = 시간당 1GB): 로드 밸런서에 따라서 처리된 HTTP(S) 요청과 응답의 바이트 수이다.
4. 교칙 평가(1LCU = 초당 1,000개의 규칙 평가): 로드 밸런서에 의해 처리된 규칙 수와 요청 속도의 곱이다.
- 이 중 최대치를 사용해서 LCU 사용료를 게산한다.

<hr/>

# 4.10 스냅샷: 서버 데이터 백업

## 4.10.1 스냅샷이란
- 스냅샷(snapshot): 어떤 시점의 서버 디스크 상태를 통째로 보존한 파일이나 폴더 등의 집합이다.
- 통째로 보존하기 때문에 데이터나 소프트웨어뿐만 아니라 OS와 설정 정보 등도 모두 포함된다.
- 소프트웨어나 OS 갱신 작업 등을 할 때 무언가 문제가 발생하면 바로 되돌릴 수 있도록 백업하기 위해 스냅샷을 사용하는 경우가 많다.
- 최초에는 통째로 보존하지만 두 번째 이후는 차분(증분)만 보존한다.
- 스냅샷을 삭제하면 해당 스냅샷 고유의 데이터만 삭제된다.
- 최초 데이터를 삭제할 경우 두 번째 스냅샷을 취득했을 때 변경되지 않는 부분(고유 데이터)만 두 번째 스냅샷으로 합쳐진 후 삭제된다.

<br/>

## 4.10.2 EBS 스냅샷을 생성하는 방법
- 스냅샷은 관리 콘솔에서 볼륨 단위(스토리지 전체)로 선택하여 생성한다.
- 생성한 스냅샷을 기반으로 EBS 볼륨을 생성하면 새로운 볼륨은 원래 볼륨의 복제가 된다.
- AMI를 작성하고 싶을 때도 스냅샷으로 작성한다.
- 데이터 수명 주기 관리자(Amazon DLM)를 사용하면 스냅샷의 생성, 삭제를 자동화할 수 있다.
- 스냅샷의 데이터 보존 장소는 Amazon S3이지만, 스냅샷 파일은 사용자가 볼 수 없는 장소에 보존된다. 그 대신 S3 요금은 발생하지 않는다.
