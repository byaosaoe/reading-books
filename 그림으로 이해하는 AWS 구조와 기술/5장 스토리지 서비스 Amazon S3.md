# 5.1 Amazon S3란: 사용하기 쉬우며 기능이 강력한 스토리지 서비스

## 5.1.1 Amazon S3란
- Amazon S3(Amazon Simple Storage Service): 스마트한 객체 스토리지 서비스
- 객체 스토리: 데이터를 객체 단위로 관리하는 형식.
- 웹서버나 회사 내의 파일 서버와 같인 인터넷 상에 데이터를 저장하는 장소를 제공해주는 것
- 용량 제한이 없으므로 최소한의 용량만으로 시작해도 된다.
- 클라우드이기 때문에 확장이나 축소도 간단하다.
- 사용한 만큼 지불하면 되므로 초기 투자 비용도 최소한으로 할 수 있다.

<br/>

## 5.1.2 견고하고 스마트한 스토리지 서비스
- 확장성: EC2와 마찬가지로 확장, 축소가 쉽다. 사용 목적에 맞게 다양한 스토리지 클래스가 준비되어 있고 수명 주기 정책을 사용하여 자동으로 이동이 가능하다.
- 가용성, 내구성: 높은 데이터 내구성을 가지고 있어 장애나 오류, 위협에 강하다. S3 객체는 최소 4개의 가용 영역에 자동으로 복제되어 보존되기 때문에 어느 한쪽에 장애가 발생하더라도 계속 사용할 수 있다.
- 신뢰성: 암호화 기능과 접근 관리 도구가 있어 공격으로부터 지키기 쉽다. 각종 규정을 준수하며 감사 기능을 갖추고 있다.
- 다양한 관리 기능: 스토리지 클래스 분석, 수명 주기 정책 등을 시작으로 각종 관리 기능이 있다. 관리 기능을 사용하면 실제 사용 환경에 맞는 스토리지 클래스를 선택하는 것이 가능하다.
- 스마트한 기능: S3 Select라는 데이터에 쿼리를 실행하는 기능과 서비스가 있다. 그 외에 분석 서비스와 호환되고, AWS Lambda와 연동할 수 있다.

<br/>

## 5.1.3 요금 체계
- `S3 요금 = 저장 용량 + 전송량`
1. 저장 용량
    - 스토리지 클래스에 따라 일할하여 계산하는 경우와 30일 단위, 90일 단위로 계산하는 경우 등 방식이 다르다.
    - 또한, 스토리지 클래스에 따라서는 최소 용량 요금이 설정되어 있으며 이 크기보다 작은 파일인 경우도 올림하여 요금이 부과된다.
2. 전송량
    - S3에서 파일을 받거나 보낼 때 발생하는 요금이다.
  
<br/>

## 5.1.4 전송량에 대한 개념
1. 수신 요청과 다운로드
    - 수신 요청(GET)이란 '이 파일이 필요해'라고 서버에 보내는 다운로드 명령을 말한다.
2. 송신 요청과 업데이트
    - 송신 요청(PUT)은 '이 파일을 저장하고 싶다'라고 서버에 파일을 전송하는 명령이다.
    - 파일을 저장할 때는 업로드이다.

<hr/>

# 5.2 스토리지 클래스: 다양한 종류의 스토리지

## 5.2.1 스토리지 클래스란
- 스토리지의 종류를 스토리지 클래스라고 한다.
- 버킷(객체를 저장하는 컨테이너) 단위가 아니고 객체(파일) 단위로 클래스를 선택할 수 있다.
- 스토리지 클래스는 상황에 따라 변경할 수 있는 점이 큰 장점이다.

<br/>

## 5.2.2 스토리지 클래스의 종류
- 어떤 스토리지 클래스를 사용하든 내구성은 99.9999999%다.
- 가용성: 시스템이 계속해서 가동하는 것

1. Standard
    - 가장 일반적인 스토리지 클래스
    - 3곳 이상의 AZ(가용 영역)에 데이터가 저장되어 있기 때문에 99.9%의 가용성을 보장한다.
    - 데이터를 검색할 때의 요금과 최소 용량의 요금이 없고 일할로 계산된다.
2. Intelligent-Tiering
    - 빈번한 액세스와 간헐적 액세스에 최적화된 두 가지 계층에 객체(파일)를 저장한다.
    - 어느 쪽에 저장할지는 객체별로 모니터링하여 그 결과에 따라 자동으로 이동.
    - 30일간 연속으로 액세스가 없는 객체는 간헐적 액세스 계층으로 이동되고, 이 객체에 대한 액세스가 늘어나면 다시 빈번한 액세스 계층으로 이동된다.
    - 이 클래스에는 검색 요금이 부과되지 않는다.
    - 액세스 계층 간 이동에 대한 요금도 부과되지 않는다.
    - 자주 사용되는 파일과 자주 사용되지 않는 파일이 섞여 있어서 액세스 빈도가 자주 바뀌는 경우에 비용을 줄일 수 있다.
    - 기본적으로 Standard와 동일하지만 최소 저장 기간에 대한 요금이 설정되어 있어 주의가 필요하다.
3. Infrequent Access
    - Standard 클래스에 비해 저장 요금이 낮게 설정되어 있는 대신 액세스 요금이 높게 설정되어 있다.
    - 액세스 빈도가 낮고 용량이 큰 데이터에 적합하다.
    - Standard-Infrequent Access와 One Zone-Infrequent Access는 저장에 사용되는 AZ의 수가 다르다.
    - Standard의 경우 최소 세 개 이상의 AZ에 저장되지만, One Zone은 한 군데이다.
4. Reduced Redundancy Storage(RRS)
    - 엄밀히 보면 스토리지 클래스가 아닌 옵션으로 분류
    - 한 종류밖에 없기 때문에 실질적으로 스토리지 클래스의 하나라고 보는게 좋다.
    - Standard에 비해 이중화 수준을 낮춰서 낮은 가격으로 제공하고 있다.
    - AZ가 한 군데이므로 문제가 발생할 경우 데이터를 유실할 가능성이 있다.
  
|Standard|Standard-Infrequent Access|Reduced Redundancy Storage|
|:---|:---|:---|
|내구성이 높다(99.999999999%)|내구성이 높다(99.999999999%)|내구성이 낮다(99.99%)|
|가용성이 높다(99.99%)|가용성이 조금 낮다(99.9%)|가용성이 높다(99.99%)|

5. S3 Glacier/S3 Glacier Deep Archive
    - 데이터 아카이브와 **장기간 백업을 고려**하여 만든 스토리지 클래스이다.
    - 99.999999999%의 내구성을 가지고 있고 가격이 낮아 **대용량 데이터를 저렴한 가격으로 보관**할 수 있다.
    - 데이터는 '볼트'라고 하는 컨테이너에 저장된다.
    - 저장된 데이터를 읽는 경우 다른 S3 버킷으로 옮겨야 하는 작업이 필요하다.
    - 범위로 검색해서 일부 데이터만 검색할 수도 있지만, 기본적으로는 통째로 검색한다.
    - 검색할 경우 Glacier상의 데이터와 검색 대상의 데이터 양쪽에 요금이 부과되므로 주의한다.

<hr/>

# 5.3 S3의 사용 절차: 스토리지 서비스를 사용하기까지
- S3는 파일을 버킷에 저장한다.
- 버킷에 저장한 파일을 객체라고 한다.
- 객체는 버킷과 객체 키, 버전으로 관리된다.

## 5.3.1 S3 조작
- 버킷의 생성 및 각종 설정과 같은 기본적인 S3 조작은 관리 콘솔의 S3 대시보드에서 수행한다.
- 일반적으로 파일을 업로드하려면 매번 관리 콘솔에서 로그인해야 하기 때문에 번거롭다.
- 하지만 S3의 경우는 API와 SDK를 사용하여 업로드할 수 있어 편리하다.
    - API: 운영 체제나 프로프래밍 언어가 제공하는 기능을 제어할 수 있도록 만든 인터페이스. 절차와 데이터 형식 등을 포함한다.
    - SDK: 소프트웨어를 만들 때 피룡한 도구를 모아 놓은 패키지.
- AWS Transfer for SFTP가 제공되어서 SFTP(SSH로 암호화된 파일 전송 프로토콜)로 액세스할 수 있다.

<br/>

## 5.3.2 S3 서비스의 기능
|항목|내용|
|:---|:---|
|객체|S3의 엔티티 단위이다. 쉽게 말하면 텍스트나 이미지 등의 파일을 말한다.|
|버킷|객체를 저장하는 컨테이너이다. 모든 객체는 버킷에 저장된다.|
|버킷명|S3 버킷의 명칭은 다른 AWS 사용자를 포함하여 유일한 이름이어야 한다. 웹 서버로 사용할 경우는 도메인명이 버킷명이 된다.|
|객체 키|객체 식별자이다. 모든 객체는 반드시 한 개의 키를 가진다. 버킷, 객체 키, 버전을 조합하여 객체를 고유하게 식별한다. 이름이라고 생각하면 된다.|
|객체 메타데이터|이름과 값의 세트이다. 객체를 업로드할 때 설정할 수 있다. 객체 키는 S3가 파일을 식별하기 위한 데이터이지만 메타데이터를 사람이 파일을 쉽게 관리하기 위한 데이터라고 생각하면 알기 쉽다.|
|리전|버킷의 물리적인 보관 장소가 있는 지역을 말한다.|
|Amazon S3의 데이터 일관성 모델|S3는 가용성을 유지하기 위해 데이터를 자동으로 복제하여 저장하지만 쓰기 지연에 의한 데이터 불일치가 발생하면 안 되기 때문에 데이터의 무결성을 보장한다. 복제가 모두 반영되기까지 다소 시간이 걸릴 수 있다.|
|버전 관리|여러 버전을 보관하는 것이다. 다른 버전은 별도의 객체로 취급하는 것이 가능하다.|
|로그|버킷 단위나 객체 단위의 로그를 기록할 수 있다. 하지만 객체 수준의 경우는 유료이다.|
|암호화|S3에 저장되는 데이터를 자동으로 암호화할 수 있다.|
|액세스 제어|S3 버킷에 대해 권한을 설정할 수 있다.|
|웹 서비스|S3 버킷을 웹 사이트로 사용하는 기능이다.|

<br/>

## 5.3.3 S3의 사용 절차
1. AWS에 로그인한다
    - 리전을 선택하고 관리 콘솔을 연다
    - S3 대시보드를 연다
2. 버킷을 만든다
    - 버킷명을 설정한다
3. 버킷을 설정한다
    - 웹 서버로 사용할 경우 Static website hosting을 설정한다
    - 접근할 수 있는 사용자를 설정한다
4. 파일을 업로드한다
- 관리 콘솔이나 전용 도구에서 파일을 업로드한다

<br/>

## 5.3.4 S3 버킷 생성 전 검토해야 할 것
- S3 버킷을 생성한 후에는 이름과 리전을 변경할 수 없다.
- 어떤 용도로 사용할지 반드시 정해야한다. 웹 서버로 사용하려면 다른 용도에 비해 차이점이 많다.
- 웹 서버로 사용할 경우 버킷에 대한 공개, 도메인, 익명 접속 허가 등을 고려해야 한다.
- 구체적으로 정하기 어려운 경우는 테스트용 버킷을 생성해 보고 확인한 후 생성한다.

<hr/>

# 5.4 객체와 버킷: 파일과 파일을 저장하는 장소
## 5.4.1 객체와 버킷이란
- 버킷은 윈도의 드라이브(C or D)와 같은 것이고, 객체는 파일과 같은 것이다.
- 버킷은 폴더가 아니므로 버킷 안에 버킷을 다시 만드는 것은 불가능하다.
- 버킷 한 개에 저장할 수 있는 객체 수는 제한이 없고 총 용량에도 제한이 없다.
- S3는 객체 스토리지이기 때문에 폴더나 디렉터리와 같은 개념이 없다. 객체는 버킷에 계층 구조가 아닌 병렬로 배치된다.
- 개념으로는 병렬이지만 사용상 편의를 위해서 관리 콘솔에 접속하면 폴더로 표시된다.
- 이렇게 표시된 폴더는 생성, 삭제, 업로드, 다운로드가 가능하다.

<br/>

## 5.4.2 버킷 생성과 명명 규칙
- 버킷을 생성하면 리전과 버킷명을 변경할 수 없다.
- 특히 버킷명은 S3 안에서 유일한 이름이어야 한다.
- 버킷 명명 규칙
    - 버킷명은 처음과 마지막에 알파벳이나 숫자를 사용해야 한다
    - 3글자 이상 63글자 이하
    - IP 주소 형식은 버킷명으로 쓸 수 없다
    - 대문자 혹은 언더스코어는 버킷명으로 사용할 수 없다
    - DNS 명명 규칙에 따라야 한다
