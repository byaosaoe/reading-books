# 7.1 데이터베이스와 RDB: 데이터를 관리하는 시스템

## 7.1.1 데이터베이스란
- 데이터베이스는 구조적으로 정리된 데이터의 집합체이다.
- 데이터가 구조화되어 있기 때문에 데이터를 검색하거나 특정 데이터만 추출하는 등 프로그램으로 데이터를 쉽게 조작할 수 있다.

<br/>

## 7.1.2 데이터베이스와 DBMS
- 데이터베이스는 어디까지나 '데이터의 집합체'이며 데이터를 조작하는 기능은 없다.
- 실제로 데이터를 조작하는 것은 데이터베이스 관리 시스템(DBMS)이다.
- 데이터베이스에 명령을 할 때 사용되는 언어 중 하나가 SQL이다.
- SQL은 명령어와 명령 방법이 정의되어 있다.
- SQL을 단독으로 사용하는 경우는 잘 없고 대부분 프로그램을 사용한다.

<br/>

## 7.1.3 DBMS
- 여러 DBMS의 기능은 크게 다르지 않다. 일부 기능이 다르거나, 처리 속도를 중시하거나, 안전성을 중시하거나, 확장하기 쉬운지 여부 등과 같이 특화된 기능이 조금씩 다를 뿐이다.
- 대규모 시스템의 경우는 벤더 지원을 받을 수 있는 유료 DBMS를 사용하는 경우가 많고, 소규모 시스템의 경우는 비용을 절감하기 위해 무료 DBMS를 사용하는 경우도 많다.

<br/>

## 7.1.4 RDB와 비RDB
- 관계형 데이터베이스
    - 표 형태로 되어 있고 데이터의 종류까지 세세하게 설정하기 때문에 구축하기까지 시간이 들지만, 그만큼 정밀한 조작이 가능하다.
    - 데이터 관련 작업은 SQL을 사용한다.
- 비관계형 데이터베이스
    - 구조가 단순하고 설정할 부분이 적기 때문에 쉽게 구축할 수 있다.
    - 복잡한 작업은 할 수 없지만 액세스가 빠르다.
    - 대표적으로 키 밸류형, 문서형 등의 구조를 가지고 있다.
    - SQL을 사용하지 않기 때문에 NoSQL 데이터베이스라고도 한다.

<hr/>

# 7.2 Amazon RDS란: 주요 RDBMS를 제공하는 데이터베이스 서비스
## 7.2.1 Amazon RDS란
- Amazon Relational Database Service(Amazon RDS)는 관계형 데이터베이스 6종류의 제품을 클라우드에 최적화된 상태로 제공하는 서비스이다.
- 데이터베이스의 제공 방식은 EC2와 비슷하다. VPC상에 인스턴스 형태로 구축하며 다양한 인스턴스 클래스를 사용할 수 있다.
- EC2와 다른 점은 RDS는 '매니지드 서비스'이며 업데이트 등의 관리가 AWS에 의해 자동으로 이루어진다는 점이다.
- 백업과 같이 번거로운 관리 작업도 자동화되어 있어 관리자가 수행할 필요가 없다.
- AWS Database Migration Server(DMS)를 사용하면 기존 데이터베이스를 이전하거나 복제하는 것도 가능하다.

<br/>

## 7.2.2 인스턴스 클래스
- RDS는 EC2와 마찬가지로 인스턴스 형식으로 사용한다.
- 인스턴스 클래스는 표준, 메모리 최적화, 버스트 성능의 3종류가 있으며 클래스에 따라 micro, small, medium, large, xlarge, 2xlarge, 4xlarge, 8xlarge, 16xlarge 크기를 제공하고 있다.
- 인스턴스 클래스에 따라 지원하지 않는 DBMS나 버전도 있다.
- 데이터베이스 인스턴스는 VPC에 설치해야 한다.
- 주요 인스턴스 클래스 종류
1. 표준
    - db.m5 등: 범용적인 인스턴스 클래스이다.
2. 메모리 최적화
    - db.x1e: 메모리를 많이 사용하는 애플리케이션에 최적화되 인스턴스 클래스로, 일부 리전에서만 제공된다.
    - db.x1: 메모리를 많이 사용하는 애플리케이션에 최적화된 인스턴스 클래스이다. 메모리 최대치가 db.x1e의 절반이다.
    - db.r5 등: 네트워크와 EBS의 성능을 강화한다. AWS Nitro System을 사용한다.
3. 버스트 성능
    - db.t3 등: CPU의 최대 사용률까지 버스트 성능으로 사용할 수 있다.
  
<br/>

## 7.2.3 RDS 요금
> RDS 요금 = ①스토리지 요금 + ②데이터베이스 인스턴스 요금 + ③백업 스토리지 요금 + ④통신료
1. 스토리지 요금
    - 사용하고 있는 스토리지에 대한 요금이다.
    - 실제 사용한 용량이 아닌 확보하고 있는 용량에 대해 과금되기 때문에 주의가 필요하다.
2. 데이터베이스 인스턴스 요금(DBMS 라이선스 요금 포함)
    - EC2 인스턴스와 마차가지로 가동한 시간당 요금이 부과된다.
    - 인스턴스 성능과 이중과 구축 여부, 사용할 데이터베이스 엔진(DBMS)에 따라서 요금이 다르다.
    - 다중 AZ로 구성하여 이중화를 구축하면 단일 AZ 구성보다 약 2배의 요금이 부과된다.
    - 유료 DBMS의 경우에는 라이선스 요금까지 추가되기 때문에 오픈 소스 데이터베이스를 사용하는 경우에 비해 비용이 높다.
3. 백업 스토리지 요금
    - 데이터베이스 인스턴스를 백업할 수 있다. 이 백업을 스냅샷이라고 한다.
    - 스냅샷은 백업 스토리지라고 하는 장소에 생성되며 사용 용량에 따라 요금을 부과한다.
    - 단, 스냅샷 요금은 리전의 데이터베이스 스토리지 크기의 100%를 넘을 경우만 발생한다.
4. 통신료
    - 데이터베이스 인스턴스가 인터넷으로 통신할 경우 해당 전송량에 대해 요금이 부과된다.
    - AZ 내에서만 통신할 경우 요금이 부과되지 않는다.
  
<br/>

## 7.2.4 RDS의 장점과 단점
- 장점
    - 매니지드 서비스라 AWS가 업데이트 등을 관리해주기 때문에 따로 관리하지 않아도 된다.
    - 간단하게 데이터베이스를 생성할 수 있다.
    - 온프레미스에서 데이터를 이전하기 쉽고 소프트웨어를 수정하지 않아도 이전이 가능하다.
    - EC2와 연동하기 쉽다.
    - 같은 네트워크 내에 있다면 통신료도 무료이다.
- 단점
    - 사용자가 자유롭게 사용할 수 없다.
    - 제공하고 있는 DBMS의 종류나 버전이 한정되어 있다.
    - AWS가 업데이트를 자동으로 수행하여 편리하지만 오히려 업데이트하면 곤란한 시점에 수행되는 경우도 있다.

<hr/>

# 7.3 RDS에서 사용할 수 있는 DBMS: 데이터베이스 엔진을 선택한다

## 7.3.1 RDS에서 사용할 수 있는 데이터베이스 엔진
- RDS는 AWS가 만든 Amazon Aurora 외에도 PostgreSQL, MySQL, MariaDB, Oracle Database, SQL Server 등 데이터베이스 엔진 6종류를 사용할 수 있으며 온프레미스에서 AWS로 쉽게 이전할 수 있다.
- SQL Server, Oracle Database와 같은 상용 데이터베이스도 지원한다. 상용 데이터베이스의 경우 데이터베이스 라이선스 요금이 인스턴스 사용 요금에 포함되어 있다.


<br/>

## 7.3.3 Amazon Aurora란
- Amazon Aurora는 MySQL이나 PostgreSQL과 호환할 수 있으며 AWS가 만든 관계형 데이터베이스이다.
- 요금이 비싼 편이지만 견고하고 성능이 뛰어나다.
- 호환성을 가지고 있기 때문에 일반적인 도구나 스냅샷을 사용하여 온프레미스 환경의 MySQL이나 PostgreSQL을 이전할 수 있고, SQL문도 그대로 사용할 수 있으며, 코드, 애플리케이션, 드라이버, 도구 등의 프로그램 및 소프트웨어를 수정할 필요도 없다.
- AWS 용으로 설계되어 있기 때문에 일반적인 MySQL이나 PostgreSQL 데이터베이스에 비해 속도가 빠르다.
- 매니지드 서비스이며 안전하게 사용할 수 있다.
- AWS에서 MySQL이나 PostgreSQL을 사용하는 방법은 3가지이다.
1. EC2에 설치하는 방법
2. RDS를 사용하는 방법
3. Amazon Aurora를 사용하는 방법
- Amazon Aurora의 경우 DBMS를 변경할 때 큰 문제가 없고, 높은 성능을 원할 경우에 추천한다.
- RDS로 이전할 때 최신 버전이나 평가판, 이전 버전은 지원하지 않을 가능성이 잇으므로 이럴 경우에는 EC2에 MySQL이나 PostgreSQL을 설치하여 이전한다.

<hr/>

# 7.4 RDS 사용 절차: 데이터베이스를 사용하기까지의 절차
## 7.4.1 RDS 조작
- 데이터베이스 작업은 데이터베이스 준비와 데이터베이스 사용으로 나누어진다.
- RDS의 경우는 소프트웨어가 EC2에 설치되어 있는 경우가 많고, 연동해서 사용한다.
- 예를 들어 워드프레스인 경우 EC2에 워드프레스 애플리케이션을 설치하고 데이터베이스는 RDS로 구축한다.

<br/>

## 7.4.2 RDS 서비스의 기능
### 1. 데이터베이스 엔진 항목

|항목|의미|
|:---|:---|
|데이터베이스 엔진|DBMS의 종류를 말한다. PostgreSQL, MySQL, MariaDB, Oracle Database, SQL Server 등이 있다.|
|템플릿|프로덕션 환경인지, 개발/테스트 환경인지를 표현한다. 프로덕션 환경을 선택하면 다중 AZ가 기본으로 활성화되는 등 해당 환경에 관한 설정을 표시된다.|
|라이선스 모델|GPL을 포함하여 라이선스 모델이 여러 개인 경우는 선택한다.|
|데이터베이스 엔진 버전|버전이 여러 개인 경우는 선택한다.|

### 2. 데이터베이스 인스턴스 항목

|항목|의미|
|:---|:---|
|인스턴스 클래스|데이터베이스의 인스턴스의 사양이다. EC2와 같이 여러 인스턴스 클래스를 제공한다.|
|다중 AZ 배포|두 개 이상의 AZ에 배포하여 이중화 구성 여부를 설정한다.|
|스토리지 유형|스토리지의 종류이다.|
|스토리지 할당|스토리지의 용량이다.|
|자동 스케일링|스토리지가 부족할 때 자동으로 늘릴지 여부를 설정한다.|
|스케일링 임계 값|자동 스케일링의 임계 값이다.|
|데이터베이스 클러스터 식별자|AWS에서 데이터베이스 클러스터를 관리하기 위한 이름이다. 데이터베이스명이 아니므로 주의해야 한다.|
|마스터 사용자명|데이터베이스 인스턴스의 관리자 권한을 가진 사용자명이다. 임의로 설정한다.|
|마스터 사용자 암호|데이터베이스 인스턴스의 관리자의 암호이다. 임의로 설정한다.|

### 3. 네트워크 항목
- RDS 인스턴스는 반드시 VPC에 설치해야 한다.
- EC2와 연동하려면 EC2가 사용하고 있는 서브넷 그룹 및 가용 영역을 확인해야 한다.

|항목|의미|
|:---|:---|
|VPC|RDS를 설치한 VPC이다. VPC의 생성은 VPC 대시보드에서 수행한다. 기본 VPC도 선택할 수 있다.|
|서브넷 그룹|RDS를 설치할 서브넷 그룹이다. EC2 인스턴스와 연동할 경우 동일한 곳에 설치하는 것이 일반적이다.|
|퍼블릭 액세스 가능|데이터베이스 인스턴스에 공인 IP 주소를 할당할지 여부를 나타낸다. 같은 VPC 내의 서비스가 아닌 곳에서 데이터베이스에 직접 접속할 경우(회사 내 서버에서 직접 RDS에 접속해야 하는 경우를 말하지만 보안 상으로 위험하므로 실제 사용 사례는 적을 것이다)에도 필요하다.|
|가용 영역|RDS를 설치할 가용 영역이다. EC2 인스턴스와 연동할 경우 동일한 곳에 설치하는 것이 일반적이다|
|보안 그룹|인스턴스 단위로 설정하는 방화벽이다. 사용할 포트를 열지 않으면 통신이 안 되므로 주의하자. 보안 그룹이 없으면 만들어두자. 설정하면서 생성도 가능하다.|


### 4. 데이터베이스 환경 항목

|항목|의미|
|:---|:---|
|데이터베이스명|데이터베이스 이름이다|
|포트|사용할 포트이다.|
|데이터베이스 파라미터 그룹|환경 설정을 위한 옵션 설정이다. 대부분의 경우 기본 설정을 사용한다|
|옵션 그룹|추가 기능에 대한 설정이다. 대부분의 경우 기본 설정을 사용한다|
|암호화|암호화 여부를 나타낸다. 인스턴스의 종류에 따라서 사용할 수 없는 경우도 있다|
|백업|자동으로 생성된 백업의 보존 기간을 말한다|
|모니터링|데이터베이스 인스턴스를 모니터링하는 방법이다. '확장 모니터링'을 활성화하면 좀 더 상세한 정보를 얻을 수 있지만 요금이 부과된다|
|로그 내보내기|Amazon CloudWatch Logs를 사용하여 로그를 출력한다|
|유지 관리|자동 업데이트에 대한 방법과 시간대를 설정한다|
|삭제 방지|삭제되지 않도록 보호 여부를 나타낸다|

<br/>

## 7.4.3 RDS의 사용 절차
- 대부분의 경우 RDS는 EC2에 설치된 소프트웨어와 연동하여 사용한다.
- 따라서 EC2와 같은 네트워크에 위치해야 하며 EC2와 연동 작업이 필요하다.
- 또한 EC2, RDS 모두 같은 VPC에 위치해야 한다.
- 즉, RDS를 구축할 때 RDS와 연동할 EC2와 VPC에 대한 정보를 미리 알아 두면 좋다.
1. AWS에 로그인한다
    - 리전을 선택하고 관리 콘솔에 접속한다
    - RDS 대시보드에 접속한다
2. DB 인스턴스를 생성한다
    - DB를 생성한다
    - 엔진을 선택한다
    - 템플릿을 선택한다
    - DB 사양을 지정한다
    - 상세 설정(DB 설정)을 한다
3. RDS에 접속한다
    - EC2에서 RDS로 접속한다
    - DB 클라이언트(관리 도구)에서 접속한다
4. 데이터를 입력한다
    - 기존 데이터 가져오기
    - 신규 데이터의 입력, 삭제, 변경하기
  
<hr/>

# 7.5 키 밸류 데이터베이스: 키를 관리하는 데이터베이스 서비스

## 7.5.1 키 밸류 스토어 데이터베이스란
- 키 밸류 스토어(key value store) 데이터베이스란 데이터의 형식에 관계없이 어떤 데이터에 대해서 특정 '키'가 되는 값을 결합하여 저장하는 방식의 데이터베이스
- 줄여서 KVS라고 표기한다
- NoSQL 데이터베이스의 대표적인 예이며 관계형 데이터베이스보다 역사가 오래되었다.
- 키라는 것은 데이터를 찾기 쉽게 하기 위한 라벨을 말한다.
- 관계형 데이터베이스와 다르게 유연성이 높아서 형식에 구애받지 않고 데이터를 입력할 수 있는 반면, 어떤 것이든 데이터로 저장하므로 상세하게 검색할 수는 없다.
- 대신 데이터에 대한 액세스가 빠르다.
- 최근에는 빅데이터나 IoT와 같은 대용량 데이터를 빠르게 처리하는 경우에도 사용되고 있어 다시 주목받고 있다.
- AWS에 키 밸류 스토어 데이터베이스는 두 가지가 있다
    1. 스토리지에 저장하는 DynamoDB
    2. 메모리에 저장하는 Amazon ElastiCache

<br/>

## 7.5.2 DynamoDB란
- 키 밸류 스토어 데이터베이스이다
- 관계형 데이터베이스에 맞지 않는 범용적 데이터를 저장하는데 사용된다
- 키 밸류 스토어 데이터베이스는 데이터끼리 연관 관계가 없기에 SQL을 사용할 수 없고 고급 검색을 할 수 없다
- RDB보다 응답속도가 빠르다
- DynamoDB는 VPC가 불필요하므로 Lambda 등과 같은 VPC를 사용하지 않는 애플리케이션 환경과 궁합이 좋다
- 대규모 데이터를 처리하기 때문에 ACID 트랜잭션, 데이터 암호화, 접근 제한 등의 서비스를 갖추고 있다
- 테이블을 글로벌 테이블로 생성하면 전 세계 각 리전에 분산되어 복제되며, 각 리전의 테이블에 데이터가 갱신되면 자동으로 동기화된다

<br/>

## 7.5.3 Amazon ElastiCache란
- 인 메모리 데이터베이스이다
- 인 메모리 데이터베이스란 데이터베이스를 조작할 때마다 외부 기억 장치에 읽기/쓰기를 수행하지 않고, 빈번하게 읽고 쓰는 데이터는 일시적으로 메모리에 보관(캐시)하는 방식으로 메모리를 활용하여 처리 속도를 빠르게 하는 데이터베이스이다.
- 처리 속도가 빠른 대신 인스턴스를 재시작할 때 데이터가 삭제된다.
- Redis용과 Memcached 용이 있어 이들과 호환할 수 있으며 현재 사용하고 있는 애플리케이션을 변경하지 않아도 사용할 수 있다

<hr/>

# 7.6 그 외의 데이터베이스: 다양한 데이터베이스 서비스를 제공한다

## 7.6.2 Amazon DocumentDB(MongoDB 호환)란
- MongoDB란 오픈 소스의 문서 기반 데이터베이스이다
- JSON 형식을 바이너리러 변환하여 BSON 형식으로 데이터를 저장할 수 있다
- 빅데이터 처리, 분산 처리에 적합한 NoSQL 데이터베이스의 하나이다
- DocumentDB는 MongoDB가 대규모의 데이터를 안정적으로 입출력할 수 있도록 설게되었다
- 기본 MongoDB 드라이버와 도구를 사용할 수 있다는 점도 특징이다

<br/>

## 7.6.3 Amazon Neptune이란
- 그래프 데이터베이스이다
- 그래프 데이터란 여러 가지 요소 사이의 관계 혹은 처리의 흐름을 나타내기 때문에 노드의 방향을 포함한 노드 사이의 연결을 기록한 데이터이다
- 대표적인 그래프 모델인 Property Graph와 W3C의 RDF에서 사용하는 쿼리 언어인 Apache TinkerPop Gremlin과 SPARQL을 지원한다
- 관리가 자동화되어 있고 네트워크를 통한 데이터의 읽기/쓰기는 HTTPS로 암호화된다
- 추천 시스템이나 소셜 네트워크, 지식 그래프 등에 사용되며 데이터간의 복잡한 관계를 처리할 수 있다

<br/>

## 7.6.4 Amazon Timestream이란
- 시계열 데이터베이스이다
- 시계열 데이터베이스란 시간의 경과에 따른 사물의 변화를 기록한 데이터로 전형적인 IoT의 데이터 취득 형태이다.
- 시간별로 취득한 데이터를 관계형 데이터베이스에 저장하는 것은 가능하지만 집약 및 집계 쿼리를 수행하기는 쉽지 않다
- Amazon Timestream에서 쿼리 처리 엔진이 시간별로 처리하는 데 최적회되어 있으며 평활법, 근사, 보간 등의 분석 함수를 사용할 수 있다
- 자원이 충돌하지 않도록 새로운 데이터를 삽입하고 기존 데이터의 쿼리를 다른 계층에서 처리한다
- 필요에 따라 스케일링되기 때문에 용량이나 부하를 고려할 필요가 없다
- 이러한 방식을 통해 IoT 데이터 처리 성능을 유지하고 데이터 관리 비용을 줄일 수 있다

<br/>

## 7.6.5 Amazon Quantum Ledger Database란
- QLDB는 장부 데이터베이스이다
- Amazon QLDB는 데이터 변경을 추적하여 이력을 남기는 저널 형식을 채용하고 있다
- 저널 데이터는 변경, 삭제가 불가능하며 암호화 해시 함수에서 변경한 내용을 변조하는 것을 방지하고 있다
- 한편 SQL과 비슷한 API나 문서 기반 데이터 모델을 제공하며 조작은 쉬운 편이다
